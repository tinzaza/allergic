<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Symptom Assessment & Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    /* Global font */
    body {
        font-family: "Inter", "Segoe UI", Roboto, system-ui, -apple-system, sans-serif;
    }

    /* Section title */
    .history-title {
        font-weight: 600;
        font-size: 1.1rem;
        color: #1f2937;
        margin-bottom: 1rem;
    }

    /* Accordion header (date row) */
    .accordion-button {
        font-weight: 500;
        font-size: 0.95rem;
        background-color: #f8fafc;
        color: #0f172a;
    }

    .accordion-button:not(.collapsed) {
        background-color: #eef2ff;
        color: #1d4ed8;
    }

    .recommendation-box {
    background: #f9fafb;
    border-left: 2px solid #0d6efd;
    padding: 20px 20px;
    border-radius: 2px;

    font-family: "Poppins", system-ui, -apple-system, sans-serif;
    font-size: 0.95rem;
    line-height: 1.75;
    color: #111827;

    white-space: pre-wrap;   /* keep line breaks */
    }


    </style>

</head>
<body class="p-4">
<div class="container col-lg-10">
    <h2 class="text-center mb-4">Symptom Assessment (‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£)</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <ul class="nav nav-tabs mb-3" id="patientTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="assessment-tab" data-bs-toggle="tab" data-bs-target="#assessment-pane" type="button" role="tab">Assessment</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="results-tab" data-bs-toggle="tab" data-bs-target="#results-pane" type="button" role="tab">Results</button>
      </li>
    </ul>

    <div class="tab-content">
      <!-- ASSESSMENT TAB -->
      <div class="tab-pane fade show active" id="assessment-pane" role="tabpanel">
        <form method="POST">
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    How many days in a week do you have symptoms?
                    <br><span class="text-muted">(1 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô)</span>
                </label>
                <input
                  type="number"
                  name="symptom_frequency"
                  class="form-control"
                  min="0"
                  max="7"
                  required
    >

            </div>
            {% if need_followup %}
            <div class="mb-3">
            <label class="form-label fw-semibold">
                ‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏™‡πÄ‡∏ï‡∏µ‡∏¢‡∏£‡∏≠‡∏¢‡∏î‡πå‡∏û‡πà‡∏ô‡∏à‡∏°‡∏π‡∏Å‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
            </label>

            <div class="form-check">
                <input class="form-check-input" type="radio"
                    name="used_steroid_before" value="yes" required>
                <label class="form-check-label">‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ</label>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="radio"
                    name="used_steroid_before" value="no">
                <label class="form-check-label">‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ</label>
            </div>
            </div>
            {% endif %}



            <div class="mb-3 row">
                <label class="col-sm-2 col-form-label">Report Date (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà)</label>
                <div class="col-sm-4">
                    <input type="date" name="report_date" class="form-control" value="{{ today if today is defined else '' }}" required>
                </div>
            </div>

            <hr>
            <h5 class="mb-3">Rate Your Symptoms (0 = none ‚Üí 10 = severe)</h5>

            {% macro slider(name, label) %}
            <div class="slider-row">
                <div style="flex:1">
                    <label class="form-label">{{ label }}</label>
                </div>
                <div style="flex:3">
                    <input type="range" class="form-range" name="{{ name }}" id="{{ name }}" min="0" max="10" value="0"
                           oninput="document.getElementById('{{ name }}_val').innerText = this.value;">
                </div>
                <div style="flex:0">
                    <div class="slider-value"> <span id="{{ name }}_val">0</span> </div>
                </div>
            </div>
            {% endmacro %}

            {{ slider("sneeze_often", "Frequent sneezing (‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏°‡∏ö‡πà‡∏≠‡∏¢)") }}
            {{ slider("itchy_nose", "Itchy nose (‡∏Ñ‡∏±‡∏ô‡∏à‡∏°‡∏π‡∏Å)") }}
            {{ slider("runny_nose", "Runny nose (‡∏ô‡πâ‡∏≥‡∏°‡∏π‡∏Å‡πÑ‡∏´‡∏•)") }}
            {{ slider("stuffy_nose", "Stuffy nose (‡∏Ñ‡∏±‡∏î‡∏à‡∏°‡∏π‡∏Å)") }}

            <hr>

            {{ slider("phlegm_throat", "Feeling of phlegm in throat (‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏°‡∏µ‡πÄ‡∏™‡∏°‡∏´‡∏∞)") }}
            {{ slider("itchy_eyes", "Itchy / red eyes (‡∏Ñ‡∏±‡∏ô‡∏ï‡∏≤ ‡∏ï‡∏≤‡πÅ‡∏î‡∏á)") }}
            {{ slider("watery_eyes", "Watery eyes (‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÑ‡∏´‡∏•‡∏ö‡πà‡∏≠‡∏¢)") }}
            {{ slider("chronic_cough", "Chronic cough (‡πÑ‡∏≠‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á)") }}
            {{ slider("itchy_throat", "Itchy throat / frequent clearing (‡∏Ñ‡∏±‡∏ô‡∏Ñ‡∏≠)") }}
            {{ slider("sore_throat", "Sore throat often (‡πÄ‡∏à‡πá‡∏ö‡∏Ñ‡∏≠‡∏ö‡πà‡∏≠‡∏¢)") }}
            {{ slider("headache", "Frequent headaches (‡∏õ‡∏ß‡∏î‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏ö‡πà‡∏≠‡∏¢)") }}
            {{ slider("dry_mouth", "Dry mouth (‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏õ‡∏≤‡∏Å‡πÅ‡∏´‡πâ‡∏á)") }}
            {{ slider("fatigue", "Easily tired / fatigued (‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢ ‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢)") }}
            {{ slider("snoring", "Snoring or noisy breathing while sleeping (‡∏ô‡∏≠‡∏ô‡∏Å‡∏£‡∏ô)") }}
            {{ slider("mouth_breathing", "Mouth breathing (‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏ó‡∏≤‡∏á‡∏õ‡∏≤‡∏Å)") }}
            {{ slider("poor_sleep", "Poor sleep / waking at night (‡∏´‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏ô‡∏¥‡∏ó)") }}
            {{ slider("daytime_sleepiness", "Daytime sleepiness (‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô)") }}
            {{ slider("loss_of_smell", "Loss of smell (‡∏à‡∏°‡∏π‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏•‡∏¥‡πà‡∏ô)") }}

            {{ slider("other_score", "Other symptom severity (‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô)") }}

            <div class="mb-3">
                <label class="form-label">Other symptom (describe):</label>
                <textarea name="other_symptom" class="form-control" rows="2"></textarea>
            </div>

            <button class="btn btn-primary w-100 mt-3">Submit Assessment</button>
        </form>
        <div class="text-center mt-3">
        <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">Logout</a>
      </div>
      </div>
      

      <!-- RESULTS TAB -->
      <div class="tab-pane fade" id="results-pane" role="tabpanel">
        <div class="mb-3">
            <h5>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h5>
            <div class="rec-card mb-3">
                {% if reports %}
            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="history-title">Assessment History</h5>

                    <div class="accordion" id="assessmentAccordion">

                    {% for r in reports %}
                    <div class="accordion-item mb-2">

                        <h2 class="accordion-header" id="heading{{ loop.index }}">
                        <button
                            class="accordion-button collapsed d-flex align-items-center gap-2"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapse{{ loop.index }}"
                            aria-expanded="false"
                            aria-controls="collapse{{ loop.index }}"
                        >
                            <span class="me-2">üìÖ</span>
                            <span class="fw-semibold">{{ r.created_at[:10] }}</span>
                        </button>
                        </h2>

                        <div
                        id="collapse{{ loop.index }}"
                        class="accordion-collapse collapse"
                        aria-labelledby="heading{{ loop.index }}"
                        data-bs-parent="#assessmentAccordion"
                        >
                        <div class="accordion-body">
                            <div class="recommendation-box"
                                <pre style="font-family: Arial;">VAS Score: {{ r.avg_vas }}
Severity: {{ r.pattern }}

{{ r.recommendation | replace('\n‚Äì ', '\n‚Ä¢ ') | safe}}</pre>
                            </div>

                        </div>
                        </div>

                    </div>
                    {% endfor %}

                    </div>

                </div>
            </div>
            {% endif %}


    <div class="text-center mt-3">
        <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">Logout</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
